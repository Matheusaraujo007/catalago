<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Loja — ManchinhaPx Arts</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0f0f10; --card:#131313; --accent:#ffcc00; --muted:#bfbfbf; --white:#fff;
}
*{box-sizing:border-box}
body{
  margin:0; font-family:"Poppins",sans-serif; background:linear-gradient(180deg,#0b0b0c,#111);
  color:var(--white);
}
header{
  padding:18px 24px; display:flex; align-items:center; justify-content:space-between;
  background:linear-gradient(90deg,#0b0b0c,#161616); border-bottom:1px solid rgba(255,255,255,0.03);
}
.brand{display:flex; align-items:center; gap:12px}
.brand .logo{width:46px;height:46px;border-radius:8px;background:linear-gradient(135deg,#222,#111);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent)}
.search{flex:1; margin:0 20px}
.search input{width:100%; padding:10px 14px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background:#0b0b0b; color:var(--white)}
.cart-btn{background:var(--accent); color:#000; padding:10px 14px; border-radius:8px; border:none; cursor:pointer; font-weight:600}

/* Grid produtos */
.container{max-width:1200px;margin:28px auto;padding:0 18px}
.filters{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:18px}
.filters select, .filters button{padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:#0b0b0b;color:var(--white)}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:18px}
@media(max-width:1000px){.grid{grid-template-columns:repeat(3,1fr)}}
@media(max-width:700px){.grid{grid-template-columns:repeat(2,1fr)} .search{display:none}}
@media(max-width:420px){.grid{grid-template-columns:1fr}}

.card{background:var(--card);border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:10px;box-shadow:0 6px 18px rgba(0,0,0,0.6)}
.thumb{height:160px;border-radius:8px;background:#0a0a0a;display:flex;align-items:center;justify-content:center;overflow:hidden}
.thumb img{width:100%;height:100%;object-fit:cover}
.title{font-weight:600;font-size:1rem}
.price{font-weight:700;color:var(--accent)}
.actions{display:flex;gap:8px;margin-top:auto}
.btn{flex:1;padding:8px 10px;border-radius:8px;border:none;cursor:pointer;font-weight:600}
.btn.info{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--white)}
.btn.buy{background:var(--accent);color:#000}

/* modal produto */
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;padding:20px;z-index:60}
.modal .dialog{width:100%;max-width:920px;background:#0f0f10;border-radius:12px;padding:18px;display:grid;grid-template-columns:1fr 1fr;gap:20px}
.modal .dialog img{width:100%;height:320px;object-fit:cover;border-radius:8px}
.modal .close{position:absolute;top:18px;right:18px;background:transparent;border:none;color:var(--white);font-size:22px;cursor:pointer}

.carousel {
  position: relative;
  width: 100%;
  height: 320px;
  overflow: hidden;
  border-radius: 8px;
  background: #0a0a0a;
  display: flex;
  align-items: center;
  justify-content: center;
}

.carousel-track {
  display: flex;
  transition: transform 0.4s ease-in-out;
  width: 100%;
  height: 100%;
}

.carousel-track img {
  min-width: 100%;
  height: 320px;
  object-fit: cover;
  border-radius: 8px;
}

.carousel button {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(15,15,15,0.6);
  color: #fff;
  border: none;
  font-size: 24px;
  cursor: pointer;
  z-index: 2;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  transition: background 0.3s;
}

.carousel button:hover {
  background: rgba(255,255,255,0.1);
}

.carousel .prev { left: 8px; }
.carousel .next { right: 8px; }

/* carrinho lateral */
.cart{position:fixed;right:0;top:0;height:100vh;width:360px;background:#0b0b0b;padding:18px;transform:translateX(100%);transition:transform .28s ease;box-shadow:-8px 0 30px rgba(0,0,0,0.6);z-index:80}
.cart.open{transform:translateX(0)}
.cart h3{margin:0 0 12px}
.cart .item{display:flex;gap:12px;align-items:center;padding:10px 0;border-bottom:1px solid rgba(255,255,255,0.03)}
.cart .item img{width:56px;height:56px;object-fit:cover;border-radius:8px}
.cart .total{display:flex;justify-content:space-between;margin-top:14px;font-weight:700;color:var(--accent)}

footer{padding:28px 18px;color:var(--muted);text-align:center}

/* ====== BANNERS ====== */
.banner-carousel {
  position: relative;
  width: 100%;
  height: 300px;
  overflow: hidden;
  margin-top: 10px;
  border-radius: 12px;
  background: #0a0a0a;
  box-shadow: 0 6px 18px rgba(0,0,0,0.6);
}

.banner-track {
  display: flex;
  transition: transform 0.6s ease-in-out;
  width: 100%;
  height: 100%;
}

.banner-track img {
  min-width: 100%;
  height: 300px;
  object-fit: cover;
  border-radius: 12px;
}

.banner-carousel button {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(15,15,15,0.6);
  color: #fff;
  border: none;
  font-size: 28px;
  cursor: pointer;
  z-index: 2;
  border-radius: 50%;
  width: 42px;
  height: 42px;
  transition: background 0.3s;
}

.banner-carousel button:hover {
  background: rgba(255,255,255,0.1);
}

.banner-carousel .prev { left: 8px; }
.banner-carousel .next { right: 8px; }


</style>
</head>
<body>
<header>
  <div class="brand">
    <div class="logo">MP</div>
    <div>
      <div style="font-weight:700">ManchinhaPx Arts</div>
      <div style="font-size:12px;color:var(--muted)">Acessórios para caminhão</div>
    </div>
  </div>

  <div class="search"><input id="q" placeholder="Buscar produtos..." /></div>

  <div style="display:flex;gap:12px;align-items:center">
    <button class="cart-btn" id="openCart">Carrinho (<span id="cartCount">0</span>)</button>
  </div>

</header>

<main class="container">
  <!-- Carrossel de Banners -->
<section class="banner-carousel" id="bannerCarousel">
  <button class="prev" id="prevBanner">❮</button>
  <div class="banner-track" id="bannerTrack"></div>
  <button class="next" id="nextBanner">❯</button>
</section>

  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
    <h2 style="margin:0">Produtos</h2>
    <div style="color:var(--muted)">Mostrando <span id="prodCount">0</span> produtos</div>
  </div>

  <div class="filters">
    <select id="filterCategoria"><option value="">Todas categorias</option></select>
    <select id="sort"><option value="recent">Mais recentes</option><option value="price_asc">Preço ↑</option><option value="price_desc">Preço ↓</option></select>
    <button id="clearFilters">Limpar filtros</button>
  </div>

  <section class="grid" id="productsGrid"></section>
</main>

<!-- Modal produto -->
<div class="modal" id="modal">
  <div class="dialog" role="dialog" aria-modal="true">
    <div style="display:flex;flex-direction:column;gap:12px">
      
      <!-- Carrossel -->
      <div class="carousel">
        <button class="prev" id="prevImg">❮</button>
        <div class="carousel-track" id="carouselTrack"></div>
        <button class="next" id="nextImg">❯</button>
      </div>
      
      
    </div>
    <div>
      <button class="close" id="closeModal">✕</button>
      <h3 id="modalTitle"></h3>
      <p id="modalDesc" style="color:var(--muted)"></p>
      <div style="margin:12px 0"><span style="font-weight:700" id="modalPrice"></span></div>
      <div style="display:flex;gap:8px;align-items:center">
        <input id="qty" type="number" value="1" min="1" style="width:80px;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:#0b0b0b;color:var(--white)">
        <button class="btn buy" id="addToCartModal">Adicionar ao carrinho</button>
      </div>
      <!-- Botão Voltar -->
<button id="btnVoltar" style="
  background-color: #333;
  color: #fff;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
  margin-top: 15px;
  width: 100%;
">
  ← Voltar
</button>
    </div>
  </div>
</div>



<!-- Carrinho -->
<aside class="cart" id="cart">
  <button id="btnVoltarCarrinho" style="
    background-color: #333;
    color: #fff;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    width: 100%;
    margin-bottom: 10px;
  ">← Voltar</button>

  <h3>Carrinho</h3>

  <div id="cartItems" style="overflow:auto;max-height:65vh;padding-right:6px"></div>
  <div class="total"><div>Total</div><div id="cartTotal">R$ 0,00</div></div>
  <div style="margin-top:12px;display:flex;gap:8px">
    <button id="btnCheckout" style="flex:1;padding:12px;border-radius:8px;border:none;background:var(--accent);color:#000;font-weight:700">Finalizar compra</button>
    <button id="btnClear" style="padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--white)">Limpar</button>
  </div>
</aside>

<footer>© ManchinhaPx Arts</footer>

<!-- Modal de Checkout -->
<div class="modal" id="checkoutModal">
  <div class="dialog" style="max-width:600px;display:flex;flex-direction:column;gap:14px">
    <button class="close" id="closeCheckout">✕</button>
    <h3>Finalizar Pedido</h3>
    <p style="color:var(--muted);margin-top:-10px">Preencha os dados abaixo para concluir seu pedido:</p>

    <input id="nomeCliente" placeholder="Nome completo" style="padding:10px;border-radius:8px;border:none;background:#0b0b0b;color:#fff">
    <input id="telefoneCliente" placeholder="Telefone (ex: 88994907177)" style="padding:10px;border-radius:8px;border:none;background:#0b0b0b;color:#fff">
    <input id="emailCliente" placeholder="E-mail" style="padding:10px;border-radius:8px;border:none;background:#0b0b0b;color:#fff">
    <textarea id="enderecoCliente" placeholder="Endereço completo" style="padding:10px;border-radius:8px;border:none;background:#0b0b0b;color:#fff;height:80px"></textarea>

    <div style="display:flex;gap:10px;align-items:center">
      <label><input type="radio" name="tipoEntrega" value="retirada" checked> Retirada</label>
      <label><input type="radio" name="tipoEntrega" value="entrega"> Entrega</label>
    </div>

    <button id="confirmarCheckout" style="padding:12px;border:none;background:var(--accent);color:#000;border-radius:8px;font-weight:700;cursor:pointer">Confirmar Pedido</button>
  </div>
</div>


<script>
/* ========== CONFIG ========= */
/*
  Substitua abaixo pela URL do seu backend na Vercel (SEM / no final),
  ex: const BACKEND = 'https://meu-backend.vercel.app';
*/
const BACKEND = "https://catalago-ashen.vercel.app";
const API_BASE = BACKEND + '/api';

let produtos = [];
let promocoes = [];
let categorias = [];
let cart = JSON.parse(localStorage.getItem('mp_cart') || '[]');

const money = v => Number(v).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

/* UI Refs */
const grid = document.getElementById('productsGrid');
const prodCount = document.getElementById('prodCount');
const q = document.getElementById('q');
const filterCategoria = document.getElementById('filterCategoria');
const sortSel = document.getElementById('sort');
const cartBtn = document.getElementById('openCart');
const cartEl = document.getElementById('cart');
const cartItems = document.getElementById('cartItems');
const cartTotalEl = document.getElementById('cartTotal');
const cartCount = document.getElementById('cartCount');
const modal = document.getElementById('modal');
const modalImg = document.getElementById('modalImg');
const modalTitle = document.getElementById('modalTitle');
const modalDesc = document.getElementById('modalDesc');
const modalPrice = document.getElementById('modalPrice');
const qtyInput = document.getElementById('qty');
const addToCartModal = document.getElementById('addToCartModal');

let banners = [];

async function fetchBanners() {
  try {
    const r = await fetch(API_BASE + '/banners');
    const bannersData = await r.json();

    const track = document.getElementById('bannerTrack');
    if (!track) return;

    // Renderiza banners vindos do banco
    track.innerHTML = bannersData.map(b => {
      const imgSrc = b.banner1
        ? (b.banner1.startsWith('data:image') ? b.banner1 : `data:image/jpeg;base64,${b.banner1}`)
        : '/placeholder-banner.png';
      return `<img src="${imgSrc}" alt="Banner ${b.id}">`;
    }).join('');

    banners = bannersData;
    startBannerCarousel();
  } catch (e) {
    console.error('Erro ao carregar banners:', e);
  }
}

let currentBanner = 0;

function startBannerCarousel() {
  const track = document.getElementById('bannerTrack');
  if (!banners.length) return;

  const prevBtn = document.getElementById('prevBanner');
  const nextBtn = document.getElementById('nextBanner');

  prevBtn.onclick = () => {
    currentBanner = (currentBanner - 1 + banners.length) % banners.length;
    track.style.transform = `translateX(-${currentBanner * 100}%)`;
  };

  nextBtn.onclick = () => {
    currentBanner = (currentBanner + 1) % banners.length;
    track.style.transform = `translateX(-${currentBanner * 100}%)`;
  };

  // Rotação automática
  setInterval(() => {
    currentBanner = (currentBanner + 1) % banners.length;
    track.style.transform = `translateX(-${currentBanner * 100}%)`;
  }, 6000);
}



/* FETCH DATA */
async function fetchProdutos(){
  try{
    const r = await fetch(API_BASE + '/produtos');
    produtos = await r.json();
    renderCategorias();
    await fetchPromocoes();
    renderProdutos();
  }catch(e){
    console.error('Erro produtos',e);
    grid.innerHTML = '<div style="color:#f33">Erro ao carregar produtos</div>';
  }
}
async function fetchPromocoes(){
  try{ const r = await fetch(API_BASE + '/promocoes'); promocoes = await r.json(); }catch(e){ promocoes = []; }
}
function aplicarPromocao(prod){
  const promo = promocoes.find(p => p.produto_id == prod.id && p.ativo);
  if(!promo) return { preco: Number(prod.preco), label: null };
  if(promo.data_fim && new Date(promo.data_fim) < new Date()) return { preco: Number(prod.preco), label: null };
  if(promo.tipo === 'percentual'){ const preco = Number(prod.preco) * (1 - Number(promo.valor)/100); return { preco, label: `${promo.valor}% OFF` }; }
  const preco = Number(prod.preco) - Number(promo.valor); return { preco: Math.max(0, preco), label: `R$ ${Number(promo.valor).toFixed(2)} OFF` };
}

/* RENDER */
function renderCategorias(){
  const set = new Set(produtos.map(p=>p.categoria_nome || p.categoria || 'Outros'));
  categorias = Array.from(set);
  filterCategoria.innerHTML = '<option value="">Todas categorias</option>' + categorias.map(c=>`<option value="${c}">${c}</option>`).join('');
}
function renderProdutos(){
  const term = q.value.trim().toLowerCase();
  let list = produtos.slice();
  if(term) list = list.filter(p => (p.nome + ' ' + (p.categoria_nome||p.categoria||'')).toLowerCase().includes(term));
  const cat = filterCategoria.value; if(cat) list = list.filter(p => (p.categoria_nome||p.categoria) === cat);
  const s = sortSel.value; if(s === 'price_asc') list.sort((a,b)=>a.preco-b.preco); if(s === 'price_desc') list.sort((a,b)=>b.preco-a.preco); if(s === 'recent') list.sort((a,b)=>b.id-a.id);
  prodCount.textContent = list.length;
  grid.innerHTML = list.map(p => {
    const promo = aplicarPromocao(p);
    const precoHtml = p.desconto_label
  ? `<div class="price">
       <small style="text-decoration:line-through;color:var(--muted)">${money(p.preco)}</small>
       <div style="color:var(--accent)">
         ${money(p.preco_final)} <span style="color:#0f0;font-size:12px">${p.desconto_label}</span>
       </div>
     </div>`
  : `<div class="price">${money(p.preco)}</div>`;
    let img = '/placeholder.png';
if (p.imagem_base64) {
  img = p.imagem_base64.startsWith('data:image')
    ? p.imagem_base64
    : `data:image/jpeg;base64,${p.imagem_base64}`;
}


    return `
      <article class="card" data-id="${p.id}">
        <div class="thumb"><img src="${img}" alt="${escapeHtml(p.nome)}"></div>
        <div class="title">${escapeHtml(p.nome)}</div>
        <div style="color:var(--muted);font-size:13px">${escapeHtml(p.categoria_nome||p.categoria||'')}</div>
        ${precoHtml}
        <div class="actions">
          <button class="btn info" data-id="${p.id}" onclick="openProduct(${p.id})">Ver detalhes</button>
          <button class="btn buy" data-id="${p.id}" onclick="addToCart(${p.id},1)">Adicionar</button>
        </div>
      </article>
    `;
  }).join('');
  updateCartUI();
}

/* CART */
function saveCart(){ localStorage.setItem('mp_cart', JSON.stringify(cart)); updateCartUI(); }
function updateCartUI() {
  cartCount.textContent = cart.reduce((s,i)=>s+i.qt,0);
  cartItems.innerHTML = cart.length === 0
    ? '<div style="color:var(--muted);padding:12px">Carrinho vazio</div>'
    : cart.map(it => {
        const prod = produtos.find(p=>p.id==it.id) || {};
        let imgCart = '/placeholder.png';
        if (prod.imagem_base64) {
          imgCart = prod.imagem_base64.startsWith('data:image')
            ? prod.imagem_base64
            : `data:image/jpeg;base64,${prod.imagem_base64}`;
        }
        return `
          <div class="item">
            <img src="${imgCart}" alt="">
            <div style="flex:1">
              <div style="font-weight:600">${escapeHtml(prod.nome||'Produto')}</div>
              <div style="color:var(--muted)">${money(it.price)} x ${it.qt}</div>
            </div>
            <div style="display:flex;flex-direction:column;gap:6px">
              <button style="background:transparent;border:none;color:var(--accent);cursor:pointer" onclick="increase(${it.id})">+</button>
              <button style="background:transparent;border:none;color:#f55;cursor:pointer" onclick="decrease(${it.id})">−</button>
            </div>
          </div>`;
      }).join('');
  const total = cart.reduce((s,i)=>s + (i.price * i.qt),0);
  cartTotalEl.textContent = money(total);
}



  const total = cart.reduce((s,i)=>s + (i.price * i.qt),0); cartTotalEl.textContent = money(total);

function addToCart(id, qtd=1){ const prod = produtos.find(p=>p.id==id); if(!prod){ alert('Produto não encontrado'); return; } const promo = aplicarPromocao(prod); const existing = cart.find(i=>i.id==id); if(existing) existing.qt += qtd; else cart.push({ id: prod.id, qt: qtd, price: Number(promo.preco || prod.preco) }); saveCart(); openCart(); }
function increase(id){ const it = cart.find(i=>i.id==id); if(it){ it.qt++; saveCart(); } }
function decrease(id){ const it = cart.find(i=>i.id==id); if(it){ it.qt--; if(it.qt<=0) cart = cart.filter(x=>x.id!=id); saveCart(); } }
function clearCart(){ if(confirm('Limpar carrinho?')){ cart=[]; saveCart(); } }

/* MODAL */
let currentIndex = 0;

function openProduct(id) {
  const p = produtos.find(x => x.id == id);
  if (!p) return;

  const imagens = Array.isArray(p.imagens) && p.imagens.length > 0
    ? p.imagens
    : (p.imagem_base64 ? [p.imagem_base64] : []);

  const track = document.getElementById('carouselTrack');
  track.innerHTML = imagens.map(img => {
    const src = img.startsWith('data:image') ? img : `data:image/jpeg;base64,${img}`;
    return `<img src="${src}" alt="">`;
  }).join('');

  currentIndex = 0;
  track.style.transform = `translateX(0%)`;

  // Eventos das setas
  document.getElementById('prevImg').onclick = () => {
    currentIndex = (currentIndex - 1 + imagens.length) % imagens.length;
    track.style.transform = `translateX(-${currentIndex * 100}%)`;
  };
  document.getElementById('nextImg').onclick = () => {
    currentIndex = (currentIndex + 1) % imagens.length;
    track.style.transform = `translateX(-${currentIndex * 100}%)`;
  };

  modalTitle.textContent = p.nome;
  modalDesc.textContent = p.descricao || '';
  const promo = aplicarPromocao(p);
  modalPrice.textContent = promo.label
    ? `${money(promo.preco)} (${promo.label})`
    : money(p.preco);
  qtyInput.value = 1;
  addToCartModal.onclick = () => {
    addToCart(p.id, Number(qtyInput.value || 1));
    closeModal();
  };

  modal.style.display = 'flex';
}
// Botão de Voltar (fecha o modal)
document.getElementById("btnVoltar").addEventListener("click", () => {
  modal.style.display = "none";
  document.body.style.overflow = "auto";
});


/* CHECKOUT */
async function checkout(){
  if(cart.length === 0){ 
    alert('Carrinho vazio'); 
    return; 
  }
  document.getElementById('checkoutModal').style.display = 'flex';
}
// Fechar modal de checkout
document.getElementById('closeCheckout').addEventListener('click', ()=>{
  document.getElementById('checkoutModal').style.display = 'none';
});

// Confirmar pedido
document.getElementById('confirmarCheckout').addEventListener('click', async ()=>{
  const nome = document.getElementById('nomeCliente').value.trim();
  const email = document.getElementById('emailCliente').value.trim();
  const telefone = document.getElementById('telefoneCliente').value.trim();
  const endereco = document.getElementById('enderecoCliente').value.trim();
  const tipoEntrega = document.querySelector('input[name="tipoEntrega"]:checked').value;

  if(!nome || !telefone){
    alert('Por favor, preencha pelo menos o nome e o telefone.');
    return;
  }

  const valor_total = cart.reduce((s,i)=>s + (i.price * i.qt),0);
  const itens = cart.map(i=>({ produto_id:i.id, quantidade:i.qt, preco_unitario:i.price }));

  try {
    // Cadastrar cliente
    const clienteRes = await fetch(API_BASE + '/clientes', {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ nome, email, telefone, endereco })
    });
    const cliente = await clienteRes.json();

    // Cadastrar venda
    const vendaRes = await fetch(API_BASE + '/vendas', {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ cliente_id: cliente.id, valor_total, status: 'pendente', itens })
    });
    const venda = await vendaRes.json();

    // Montar mensagem de resumo
    const resumoItens = cart.map(it=>{
      const prod = produtos.find(p=>p.id==it.id);
      return `*${it.qt}* x *${prod?.nome || 'Produto'}*: R$ ${(it.price).toFixed(2)}`;
    }).join('\n--------\n');

    const mensagem = 
`Olá, meu nome é *${nome}*, esse é o meu pedido realizado através da loja *Manchinha Px Arts*
--------
${resumoItens}
--------
Quantidade de itens: *${cart.length}*
Total dos itens: *${money(valor_total)}*
--------
Valor da entrega: *A DEFINIR*
Valor Total: *${money(valor_total)}*
Veja o resumo do seu pedido aqui:
${BACKEND}/pedido/${venda.id}
--------
${tipoEntrega === 'retirada' ? 'Retirada em loja' : 'Entrega'}: *Manchinha Px Arts*
Contato: *(88) 99490-7177*
Número do pedido: *${venda.id}*
--------
Pedido feito com *Manchinha Px Arts*`;

    // Enviar pelo WhatsApp (abrir janela com texto pronto)
    const linkWhats = `https://wa.me/5588994907177?text=${encodeURIComponent(mensagem)}`;
    window.open(linkWhats, '_blank');

    // Limpar carrinho
    cart = [];
    saveCart();
    document.getElementById('checkoutModal').style.display = 'none';
    closeCart();
    alert('Pedido enviado com sucesso!');

  } catch (e) {
    console.error(e);
    alert('Erro ao criar pedido.');
  }
});


// Botão de Voltar do Carrinho
document.getElementById('btnVoltarCarrinho').addEventListener('click', () => {
  closeCart(); // usa a função já existente para fechar o carrinho
});


/* UI helpers */
function openCart(){ cartEl.classList.add('open'); } function closeCart(){ cartEl.classList.remove('open'); }
document.getElementById('btnCheckout').onclick = checkout;
document.getElementById('btnClear').onclick = clearCart;
cartBtn.addEventListener('click', ()=> openCart());
document.getElementById('closeModal').addEventListener('click', closeModal);
modal.addEventListener('click', (e)=>{ if(e.target===modal) closeModal(); });

/* SEARCH & FILTER */
q.addEventListener('input', ()=> renderProdutos());
filterCategoria.addEventListener('change', ()=> renderProdutos());
sortSel.addEventListener('change', ()=> renderProdutos());
document.getElementById('clearFilters').addEventListener('click', ()=>{ q.value=''; filterCategoria.value=''; sortSel.value='recent'; renderProdutos(); });

/* INIT */
function escapeHtml(text){ return String(text||'').replace(/[&<>"']/g, s=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[s]); }
fetchProdutos();
updateCartUI();


fetchBanners();
window.addToCart = addToCart;
window.openProduct = openProduct;
window.increase = increase;
window.decrease = decrease;
</script>
</body>
</html>
