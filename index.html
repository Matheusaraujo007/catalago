<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Loja Online - Catálogo</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Poppins', sans-serif; background: #f4f6f8; margin: 0; padding: 0; }
  header {
    background: linear-gradient(90deg, #1e3a8a, #2563eb);
    color: white;
    padding: 20px 40px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    flex-wrap: wrap;
  }
  .logo { display: flex; align-items: center; gap: 10px; font-size: 1.6em; font-weight: 700; }
  .logo span { font-size: 1.8em; }
  .header-text { font-size: 1em; font-weight: 500; text-align: right; }
  @media (max-width: 600px) {
    header { flex-direction: column; text-align: center; }
    .header-text { margin-top: 10px; }
  }
  header { position: relative; text-align: center; }
  /* WhatsApp profissional */
/* WhatsApp profissional */
.whatsapp-btn {
  position: fixed;
  bottom: 25px;
  right: 25px;
  width: 60px;
  height: 60px;
  background: #25D366; /* Verde oficial WhatsApp */
  border-radius: 50%;
  box-shadow: 0 6px 20px rgba(0,0,0,0.25);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.3s, box-shadow 0.3s;
  z-index: 1000;
}

.whatsapp-btn:hover {
  transform: scale(1.1);
  box-shadow: 0 8px 25px rgba(0,0,0,0.35);
}

.whatsapp-btn img {
  width: 28px;
  height: 28px;
}


  main { max-width: 1200px; margin: 40px auto; padding: 0 20px; }
  h2 { color: #1e293b; margin-bottom: 20px; }
  .filtro-categoria { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
  .filtro-categoria button { padding: 8px 16px; border: none; border-radius: 8px; background-color: #2563eb; color: white; cursor: pointer; transition: 0.3s; }
  .filtro-categoria button:hover, .filtro-categoria button.active { background-color: #1e3a8a; }
  .catalogo { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; }
  .produto { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: flex; flex-direction: column; justify-content: space-between; transition: transform 0.2s, box-shadow 0.2s; }
  .produto:hover { transform: translateY(-5px); box-shadow: 0 6px 18px rgba(0,0,0,0.15); }
  .produto h3 { margin: 0; font-size: 1.1em; color: #1e293b; }
  .produto p { margin: 5px 0 10px; color: #334155; font-size: 0.95em; }
  .produto button { background-color: #16a34a; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; transition: 0.3s; }
  .produto button:hover { background-color: #15803d; }

  /* Carrossel */
  .carrossel { position: relative; width: 100%; height: 160px; overflow: hidden; border-radius: 8px; margin-bottom: 10px; }
  .carrossel img { width: 100%; height: 160px; object-fit: cover; display: none; }
  .carrossel img.active { display: block; }
  .carrossel button { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.4); color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 4px; }
  .carrossel .prev { left: 10px; }
  .carrossel .next { right: 10px; }

  .carrinho { position: fixed; right: 20px; top: 100px; width: 300px; max-height: 80%; background: white; border-radius: 12px; box-shadow: 0 6px 20px rgba(0,0,0,0.15); padding: 15px; overflow-y: auto; }
  .carrinho h3 { margin-top: 0; }
  .carrinho-item { display: flex; justify-content: space-between; margin-bottom: 10px; }
  .carrinho-item button { background-color: #dc2626; padding: 4px 8px; font-size: 0.8em; border-radius: 6px; }
  .finalizar { width: 100%; padding: 10px; border: none; background-color: #2563eb; color: white; font-size: 1em; border-radius: 8px; cursor: pointer; margin-top: 10px; }
  .finalizar:hover { background-color: #1e3a8a; }

  .modal { display: none; position: fixed; z-index: 10; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
  .modal-content { 
  background-color: white; 
  margin: 60px auto; 
  padding: 25px; 
  border-radius: 12px; 
  max-width: 500px;  /* Aumentei o tamanho */
  width: 90%;        /* Responsivo */
  animation: slideDown 0.4s ease; 
  word-wrap: break-word;
  white-space: pre-wrap; /* Mantém quebras de linha da descrição */
}
  @keyframes slideDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
  .modal-content h3 { margin-top: 0; }
  .modal-content label { display: block; margin: 10px 0 5px; font-weight: 500; }
  .modal-content input, .modal-content select { width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #cbd5e1; margin-bottom: 10px; font-size: 0.95em; }
  .modal-content .entrega-info { display: none; }
  .modal-content button { background-color: #16a34a; color: white; border: none; padding: 10px; width: 100%; font-size: 1em; border-radius: 8px; cursor: pointer; margin-top: 10px; }
  .modal-content button:hover { background-color: #15803d; }
  .fechar { float: right; font-size: 1.2em; cursor: pointer; }

  /* Estilo do modal de detalhes */
#conteudoDetalhes img {
  width: 100%;
  height: 200px;
  object-fit: cover;
  border-radius: 8px;
  margin-bottom: 10px;
}
#conteudoDetalhes h3 {
  margin: 10px 0 5px;
  color: #1e293b;
}
#conteudoDetalhes p {
  margin: 5px 0 10px;
  color: #334155;
}
#conteudoDetalhes .detalhes-whatsapp {
  display: inline-block;
  background-color: #25D366;
  color: white;
  padding: 10px 15px;
  border-radius: 8px;
  text-decoration: none;
  font-weight: 500;
  transition: transform 0.3s;
}
#conteudoDetalhes .detalhes-whatsapp:hover {
  transform: scale(1.05);
}

#modalDetalhes .carrossel {
  width: 100%;
  max-height: 650px;
  overflow: hidden;
  position: relative;
  border-radius: 12px;
  margin-bottom: 15px;
}

#modalDetalhes .carrossel img {
  width: 100%;
  max-height: 650px;
  display: none;
  object-fit: contain;
  border-radius: 12px;
}

#modalDetalhes .carrossel img.active {
  display: block;
}

#modalDetalhes .carrossel button {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(0,0,0,0.35);
  color: white;
  border: none;
  width: 40px;
  height: 40px;
  cursor: pointer;
  border-radius: 50%;
  font-size: 1.5em;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.3s, transform 0.3s;
  z-index: 2;
}

#modalDetalhes .carrossel button:hover {
  background: rgba(0,0,0,0.7);
  transform: scale(1.1);
}

#modalDetalhes .carrossel .prev {
  left: 10px; /* 10px dentro da borda da imagem */
}

#modalDetalhes .carrossel .next {
  right: 10px; /* 10px dentro da borda da imagem */
}

.botoes-detalhes {
  display: flex;
  gap: 10px;
  margin-top: 20px;
  justify-content: space-between;
  align-items: stretch; /* garante mesma altura exata */
}

.btn-detalhe {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 50px;
  padding: 0 12px;
  line-height: 1;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  color: white;
  font-size: 15px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-decoration: none;
  box-shadow: 0 3px 8px rgba(0,0,0,0.15);
}

/* Força que tanto <a> quanto <button> se comportem idênticos */
.btn-detalhe,
.btn-detalhe:visited {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  text-align: center;
  appearance: none;
  -webkit-appearance: none;
}

.btn-detalhe.whatsapp {
  background: linear-gradient(90deg, #25D366, #1EBE57);
  margin-top: -5px;
}

.btn-detalhe.whatsapp:hover {
  background: linear-gradient(90deg, #1EBE57, #1DA851);
  transform: translateY(-2px);
}

.btn-detalhe.comprar {
  background: linear-gradient(90deg, #2563EB, #1E40AF);
  margin-top: -5px; /* 🔼 Sobe o botão */
  /* use margin-top positivo para descer */
}

.btn-detalhe.comprar:hover {
  background: linear-gradient(90deg, #1E40AF, #1D4ED8);
  transform: translateY(-2px);
}
</style>
</head>
<body>
<header>
  <div class="logo">
    <img src="logo1.jpeg" alt="Logo da loja">
    <span></span> ManchinhaPx Arts
  </div>
  <div class="header-text">
    Faça seu pedido agora mesmo 💬
    <!-- Botão WhatsApp profissional -->
<a href="https://wa.me/5588993800944" target="_blank" class="whatsapp-btn" title="Fale conosco no WhatsApp">
  <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
</a>
  </div>
</header>

<main>
  <h2>Filtrar por Categoria</h2>
  <div class="filtro-categoria" id="filtroCategorias"></div>
  <div class="catalogo" id="catalogo"></div>
</main>

<div class="carrinho" id="carrinho">
  <h3>Carrinho 🛒</h3>
  <div id="itensCarrinho"></div>
  <button class="finalizar" id="finalizar">Finalizar Pedido</button>
</div>

<div class="modal" id="modalForm">
  <div class="modal-content">
    <span class="fechar" id="fecharModal">&times;</span>
    <h3>Informações do Pedido</h3>
    <label>Nome do Cliente:</label>
    <input type="text" id="nomeCliente" placeholder="Digite seu nome" required>
    <label>Opção:</label>
    <select id="tipoEntrega">
      <option value="Retirada">Retirada</option>
      <option value="Entrega">Entrega</option>
    </select>
    <div class="entrega-info" id="dadosEntrega">
      <label>Rua:</label><input type="text" id="rua" placeholder="Digite sua rua">
      <label>Número:</label><input type="text" id="numero" placeholder="Número">
      <label>Bairro:</label><input type="text" id="bairro" placeholder="Bairro">
      <label>Cidade:</label><input type="text" id="cidade" placeholder="Cidade">
      <label>CEP:</label><input type="text" id="cep" placeholder="CEP">
    </div>
    <button id="enviarPedido">Enviar Pedido via WhatsApp</button>
  </div>
</div>

<div class="modal" id="modalDetalhes">
  <div class="modal-content">
    <span class="fechar" id="fecharDetalhes">&times;</span>
    <div id="conteudoDetalhes"></div>
  </div>
</div>

<script>
let produtos = [];
const catalogo = document.getElementById('catalogo');
const itensCarrinho = document.getElementById('itensCarrinho');
let carrinho = [];
const filtroCategorias = document.getElementById('filtroCategorias');

// Carregar produtos
async function carregarProdutos() {
  try {
    const res = await fetch('/api/produtos'); 
    produtos = await res.json();

    const categorias = ['Todos', ...new Set(produtos.map(p=>p.categoria))];
    filtroCategorias.innerHTML = '';
    categorias.forEach(cat=>{
      const btn = document.createElement('button');
      btn.textContent = cat;
      btn.dataset.categoria = cat;
      if(cat==='Todos') btn.classList.add('active');
      btn.addEventListener('click', ()=> filtrarProdutos(cat, btn));
      filtroCategorias.appendChild(btn);
    });

    mostrarProdutos();
  } catch(err){
    console.error("Erro ao carregar produtos:", err);
    catalogo.innerHTML = "<p>Erro ao carregar produtos.</p>";
  }
}

function filtrarProdutos(categoria, btn){
  document.querySelectorAll('#filtroCategorias button').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  mostrarProdutos(categoria);
}

// Mostrar produtos com carrossel
function mostrarProdutos(categoria = "Todos") {
  catalogo.innerHTML = "";
  produtos.forEach((p,i)=>{
    if(categoria==='Todos' || p.categoria===categoria){
      const div = document.createElement('div');
      div.className = 'produto';

      function mudarImagemModal(dir){
  const carrossel = document.getElementById('carrossel-modal');
  if(!carrossel) return;
  const imgs = carrossel.querySelectorAll('img');
  let index = Array.from(imgs).findIndex(img => img.classList.contains('active'));
  imgs[index].classList.remove('active');
  index = (index + dir + imgs.length) % imgs.length;
  imgs[index].classList.add('active');
}

      div.innerHTML = `
        ${imagensHTML}
        <h3>${p.nome}</h3>
        <p>Categoria: ${p.categoria}</p>
        <p>Preço: R$ ${Number(p.preco).toFixed(2)}</p>
        <button onclick="adicionarCarrinho(${i})">Comprar</button>
      `;
      catalogo.appendChild(div);
    }
  });
}

// Navegar carrossel
function mudarImagem(i, dir){
  const carrossel = document.getElementById(`carrossel-${i}`);
  if(!carrossel) return;
  const imgs = carrossel.querySelectorAll('img');
  let index = Array.from(imgs).findIndex(img => img.classList.contains('active'));
  imgs[index].classList.remove('active');
  index = (index + dir + imgs.length) % imgs.length;
  imgs[index].classList.add('active');
}

// Carrinho
function adicionarCarrinho(i){
  const produto = produtos[i];
  const existe = carrinho.find(item => item.codigo === produto.codigo);
  if(existe){ existe.quantidade += 1; } 
  else { carrinho.push({...produto, quantidade:1}); }
  atualizarCarrinho();
}

function atualizarCarrinho(){
  itensCarrinho.innerHTML = '';
  carrinho.forEach((item,index)=>{
    const div = document.createElement('div');
    div.className = 'carrinho-item';
    div.innerHTML = `<span>${item.nome} x${item.quantidade}</span>
    <button onclick="removerCarrinho(${index})">❌</button>`;
    itensCarrinho.appendChild(div);
  });
}

function removerCarrinho(index){
  carrinho.splice(index,1);
  atualizarCarrinho();
}

// Modal
const modal = document.getElementById('modalForm');
const btnFinalizar = document.getElementById('finalizar');
const btnFechar = document.getElementById('fecharModal');
const tipoEntrega = document.getElementById('tipoEntrega');
const dadosEntrega = document.getElementById('dadosEntrega');
const btnEnviar = document.getElementById('enviarPedido');

btnFinalizar.addEventListener('click', ()=>{
  if(carrinho.length===0){ alert("O carrinho está vazio!"); return; }
  modal.style.display = 'block';
});

btnFechar.addEventListener('click', ()=> modal.style.display='none');
window.onclick = e=> { if(e.target===modal) modal.style.display='none'; };
tipoEntrega.addEventListener('change', ()=>{ dadosEntrega.style.display = tipoEntrega.value==='Entrega'? 'block':'none'; });

btnEnviar.addEventListener('click', ()=>{
  const nomeCliente = document.getElementById('nomeCliente').value.trim();
  if(!nomeCliente){ alert("Preencha seu nome!"); return; }

  let mensagem = `Olá, meu nome é ${nomeCliente}.%0APedido:%0A`;
  let total = 0;
  carrinho.forEach(item=>{
    const subtotal = Number(item.preco) * item.quantidade;
    total += subtotal;
    mensagem += `- ${item.nome} x${item.quantidade} (R$ ${subtotal.toFixed(2)})%0A`;
  });

  mensagem += `Opção: ${tipoEntrega.value}%0A`;
  if(tipoEntrega.value === 'Entrega'){
    const rua = document.getElementById('rua').value.trim();
    const numero = document.getElementById('numero').value.trim();
    const bairro = document.getElementById('bairro').value.trim();
    const cidade = document.getElementById('cidade').value.trim();
    const cep = document.getElementById('cep').value.trim();
    mensagem += `Endereço: ${rua}, ${numero}, ${bairro}, ${cidade}, CEP: ${cep}%0A`;
  }

  mensagem += `%0ATotal: R$ ${total.toFixed(2)}`;
  const whatsapp = "5588993800944";
  window.open(encodeURI(`https://wa.me/${whatsapp}?text=${mensagem}`), "_blank");
  modal.style.display = 'none';
});

// Modal de detalhes
const modalDetalhes = document.getElementById('modalDetalhes');
const fecharDetalhes = document.getElementById('fecharDetalhes');
const conteudoDetalhes = document.getElementById('conteudoDetalhes');

function abrirDetalhes(index){
  const p = produtos[index];
  
  let imagensHTML = '';
  if (p.imagens && p.imagens.length > 0) {
    imagensHTML = `<div class="carrossel" id="carrossel-modal">`;
    p.imagens.forEach((img, j) => {
      imagensHTML += `<img src="${img}" class="${j === 0 ? 'active' : ''}" alt="${p.nome}">`;
    });
    imagensHTML += `
      <button class="prev" onclick="mudarImagemModal(-1)">&#10094;</button>
      <button class="next" onclick="mudarImagemModal(1)">&#10095;</button>
    </div>`;
  } else {
    imagensHTML = `<div style="width:100%; height:200px; background:#e2e8f0; display:flex; align-items:center; justify-content:center; border-radius:8px;">Sem imagem</div>`;
  }

  conteudoDetalhes.innerHTML = `
    ${imagensHTML}
    <h3>${p.nome}</h3>
    <p><strong>Preço:</strong> R$ ${Number(p.preco).toFixed(2)}</p>
    <p><strong>Descrição:</strong> ${p.descricao || 'Sem descrição'}</p>

    <div class="botoes-detalhes">
      <a href="https://wa.me/5588993800944?text=Olá,%20gostaria%20de%20comprar%20o%20produto%20${encodeURIComponent(p.nome)}" 
         target="_blank" 
         class="btn-detalhe whatsapp">Chamar no WhatsApp</a>
      <button onclick="adicionarCarrinho(${index}); fecharModalDetalhes()" 
              class="btn-detalhe comprar">🛒 Comprar</button>
    </div>
  `;

  modalDetalhes.style.display = 'block';
}

function fecharModalDetalhes() {
  modalDetalhes.style.display = 'none';
}

function mudarImagemModal(dir){
  const carrossel = document.getElementById('carrossel-modal');
  if(!carrossel) return;
  const imgs = carrossel.querySelectorAll('img');
  let index = Array.from(imgs).findIndex(img => img.classList.contains('active'));
  imgs[index].classList.remove('active');
  index = (index + dir + imgs.length) % imgs.length;
  imgs[index].classList.add('active');
}

fecharDetalhes.addEventListener('click', ()=> modalDetalhes.style.display='none');
window.onclick = e=> { if(e.target===modalDetalhes) modalDetalhes.style.display='none'; };

// Alterar mostrarProdutos para usar "Ver Detalhes"
function mostrarProdutos(categoria = "Todos") {
  catalogo.innerHTML = "";
  produtos.forEach((p,i)=>{
    if(categoria==='Todos' || p.categoria===categoria){
      const div = document.createElement('div');
      div.className = 'produto';

      let imagensHTML = '';
      if(p.imagens && p.imagens.length > 0){
        imagensHTML = `<div class="carrossel" id="carrossel-${i}">`;
        p.imagens.forEach((img,j)=>{
          imagensHTML += `<img src="${img}" class="${j===0 ? 'active' : ''}">`;
        });
        imagensHTML += `
          <button class="prev" onclick="mudarImagem(${i},-1)">&#10094;</button>
          <button class="next" onclick="mudarImagem(${i},1)">&#10095;</button>
        </div>`;
      } else {
        imagensHTML = `<div style="width:100%; height:160px; background:#e2e8f0; display:flex; align-items:center; justify-content:center; border-radius:8px; margin-bottom:10px;">Sem imagem</div>`;
      }

      div.innerHTML = `
        ${imagensHTML}
        <h3>${p.nome}</h3>
        <p>Categoria: ${p.categoria}</p>
        <p>Preço: R$ ${Number(p.preco).toFixed(2)}</p>
        <button onclick="abrirDetalhes(${i})">Ver Detalhes</button>
      `;
      catalogo.appendChild(div);
    }
  });
}

// Iniciar
carregarProdutos();
</script>
</body>
</html>
