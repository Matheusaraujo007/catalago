<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Loja Online - Cat√°logo</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Poppins', sans-serif; background: #f4f6f8; margin: 0; padding: 0; }
  header {
    background: linear-gradient(90deg, #1e3a8a, #2563eb);
    color: white;
    padding: 20px 40px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    flex-wrap: wrap;
  }
  .logo { display: flex; align-items: center; gap: 10px; font-size: 1.6em; font-weight: 700; }
  .logo span { font-size: 1.8em; }
  .header-text { font-size: 1em; font-weight: 500; text-align: right; }
  @media (max-width: 600px) {
    header { flex-direction: column; text-align: center; }
    .header-text { margin-top: 10px; }
  }
  header { position: relative; text-align: center; }

  .logo img {
  max-width: 120px;    /* largura m√°xima */
  height: auto;        /* mant√©m propor√ß√£o */
  object-fit: contain; /* evita distor√ß√£o */
  border-radius: 8px;  /* deixa cantos suaves */
  transition: transform 0.3s ease;
}

.logo img:hover {
  transform: scale(1.05); /* efeito sutil ao passar o mouse */
}

  /* WhatsApp profissional */
/* WhatsApp profissional */
.whatsapp-btn {
  position: fixed;
  bottom: 25px;
  right: 25px;
  width: 60px;
  height: 60px;
  background: #25D366; /* Verde oficial WhatsApp */
  border-radius: 50%;
  box-shadow: 0 6px 20px rgba(0,0,0,0.25);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.3s, box-shadow 0.3s;
  z-index: 1000;
}

.whatsapp-btn:hover {
  transform: scale(1.1);
  box-shadow: 0 8px 25px rgba(0,0,0,0.35);
}

.whatsapp-btn img {
  width: 28px;
  height: 28px;
}


  main { max-width: 1200px; margin: 40px auto; padding: 0 20px; }
  h2 { color: #1e293b; margin-bottom: 20px; }
  .filtro-categoria { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
  .filtro-categoria button { padding: 8px 16px; border: none; border-radius: 8px; background-color: #2563eb; color: white; cursor: pointer; transition: 0.3s; }
  .filtro-categoria button:hover, .filtro-categoria button.active { background-color: #1e3a8a; }
  .catalogo { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; }
  .produto { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: flex; flex-direction: column; justify-content: space-between; transition: transform 0.2s, box-shadow 0.2s; }
  .produto:hover { transform: translateY(-5px); box-shadow: 0 6px 18px rgba(0,0,0,0.15); }
  .produto h3 { margin: 0; font-size: 1.1em; color: #1e293b; }
  .produto p { margin: 5px 0 10px; color: #334155; font-size: 0.95em; }
  .produto button { background-color: #16a34a; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; transition: 0.3s; }
  .produto button:hover { background-color: #15803d; }

  /* Carrossel */
  .carrossel { position: relative; width: 100%; height: 160px; overflow: hidden; border-radius: 8px; margin-bottom: 10px; }
  .carrossel img { width: 100%; height: 160px; object-fit: cover; display: none; }
  .carrossel img.active { display: block; }
  .carrossel button { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.4); color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 4px; }
  .carrossel .prev { left: 10px; }
  .carrossel .next { right: 10px; }

  /* üõí Carrinho moderno e profissional */
/* Carrinho modal (invis√≠vel por padr√£o) */
.carrinho {
  position: fixed;
  right: -400px; /* come√ßa escondido fora da tela */
  top: 80px;
  width: 310px;
  max-height: 80%;
  background: #ffffff;
  border-radius: 16px;
  box-shadow: 0 6px 25px rgba(0,0,0,0.15);
  padding: 20px;
  overflow-y: auto;
  transition: right 0.4s ease;
  z-index: 1000;
}

.carrinho.aberto {
  right: 25px; /* entra na tela */
}

.carrinho-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: #f9fafb;
  border-radius: 10px;
  padding: 10px;
  margin-bottom: 12px;
  transition: transform 0.2s;
}

.carrinho-item:hover {
  transform: translateX(3px);
}

.carrinho-item img {
  width: 45px;
  height: 45px;
  border-radius: 8px;
  object-fit: cover;
  margin-right: 10px;
  border: 1px solid #e2e8f0;
}

.carrinho-item .info {
  flex: 1;
  display: flex;
  flex-direction: column;
  font-size: 0.9em;
  color: #1e293b;
}

.carrinho-item .info strong {
  font-weight: 600;
  font-size: 0.95em;
}

.carrinho-item button {
  background-color: #ef4444;
  color: white;
  border: none;
  padding: 5px 8px;
  font-size: 0.85em;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.3s;
}

.carrinho-item button:hover {
  background-color: #dc2626;
}

.total-carrinho {
  display: flex;
  justify-content: space-between;
  font-weight: 600;
  font-size: 1em;
  margin-top: 10px;
  color: #1e3a8a;
}

.finalizar {
  width: 100%;
  padding: 12px;
  border: none;
  background: linear-gradient(90deg, #2563EB, #1E40AF);
  color: white;
  font-size: 1em;
  font-weight: 600;
  border-radius: 10px;
  cursor: pointer;
  margin-top: 12px;
  transition: all 0.3s ease;
}

.finalizar:hover {
  background: linear-gradient(90deg, #1E40AF, #1D4ED8);
  transform: translateY(-2px);
}

  .modal { display: none; position: fixed; z-index: 10; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
  .modal-content { 
  background-color: white; 
  margin: 60px auto; 
  padding: 25px; 
  border-radius: 12px; 
  max-width: 500px;  /* Aumentei o tamanho */
  width: 90%;        /* Responsivo */
  animation: slideDown 0.4s ease; 
  word-wrap: break-word;
  white-space: pre-wrap; /* Mant√©m quebras de linha da descri√ß√£o */
}
  @keyframes slideDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
  .modal-content h3 { margin-top: 0; }
  .modal-content label { display: block; margin: 10px 0 5px; font-weight: 500; }
  .modal-content input, .modal-content select { width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #cbd5e1; margin-bottom: 10px; font-size: 0.95em; }
  .modal-content .entrega-info { display: none; }
  .modal-content button { background-color: #16a34a; color: white; border: none; padding: 10px; width: 100%; font-size: 1em; border-radius: 8px; cursor: pointer; margin-top: 10px; }
  .modal-content button:hover { background-color: #15803d; }
  .fechar { float: right; font-size: 1.2em; cursor: pointer; }

  /* Estilo do modal de detalhes */
#conteudoDetalhes img {
  width: 100%;
  height: 200px;
  object-fit: cover;
  border-radius: 8px;
  margin-bottom: 10px;
}
#conteudoDetalhes h3 {
  margin: 10px 0 5px;
  color: #1e293b;
}
#conteudoDetalhes p {
  margin: 5px 0 10px;
  color: #334155;
}
#conteudoDetalhes .detalhes-whatsapp {
  display: inline-block;
  background-color: #25D366;
  color: white;
  padding: 10px 15px;
  border-radius: 8px;
  text-decoration: none;
  font-weight: 500;
  transition: transform 0.3s;
}
#conteudoDetalhes .detalhes-whatsapp:hover {
  transform: scale(1.05);
}

#modalDetalhes .carrossel {
  width: 100%;
  max-height: 650px;
  overflow: hidden;
  position: relative;
  border-radius: 12px;
  margin-bottom: 15px;
}

#modalDetalhes .carrossel img {
  width: 100%;
  max-height: 650px;
  display: none;
  object-fit: contain;
  border-radius: 12px;
}

#modalDetalhes .carrossel img.active {
  display: block;
}

#modalDetalhes .carrossel button {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(0,0,0,0.35);
  color: white;
  border: none;
  width: 40px;
  height: 40px;
  cursor: pointer;
  border-radius: 50%;
  font-size: 1.5em;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.3s, transform 0.3s;
  z-index: 2;
}

#modalDetalhes .carrossel button:hover {
  background: rgba(0,0,0,0.7);
  transform: scale(1.1);
}

#modalDetalhes .carrossel .prev {
  left: 10px; /* 10px dentro da borda da imagem */
}

#modalDetalhes .carrossel .next {
  right: 10px; /* 10px dentro da borda da imagem */
}

.botoes-detalhes {
  display: flex;
  gap: 10px;
  margin-top: 20px;
  justify-content: space-between;
  align-items: stretch; /* garante mesma altura exata */
}

.btn-detalhe {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 50px;
  padding: 0 12px;
  line-height: 1;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  color: white;
  font-size: 15px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-decoration: none;
  box-shadow: 0 3px 8px rgba(0,0,0,0.15);
}

/* For√ßa que tanto <a> quanto <button> se comportem id√™nticos */
.btn-detalhe,
.btn-detalhe:visited {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  text-align: center;
  appearance: none;
  -webkit-appearance: none;
}

.btn-detalhe.whatsapp {
  background: linear-gradient(90deg, #25D366, #1EBE57);
  margin-top: -5px;
}

.btn-detalhe.whatsapp:hover {
  background: linear-gradient(90deg, #1EBE57, #1DA851);
  transform: translateY(-2px);
}

.btn-detalhe.comprar {
  background: linear-gradient(90deg, #2563EB, #1E40AF);
  margin-top: -5px; /* üîº Sobe o bot√£o */
  /* use margin-top positivo para descer */
}

.btn-detalhe.comprar:hover {
  background: linear-gradient(90deg, #1E40AF, #1D4ED8);
  transform: translateY(-2px);
}

/* √çcone do carrinho */
/* Carrinho */
.carrinho-icon {
  position: fixed;
  bottom: var(--posicao-vertical, 100px); /* controla a altura do bot√£o */
  right: var(--posicao-horizontal, 25px); /* controla a dist√¢ncia da direita */
  background: #2563EB;
  border: none;
  border-radius: 50%;
  width: 60px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 6px 20px rgba(0,0,0,0.25);
  z-index: 9999; /* Garante que fique sempre vis√≠vel */
}

.carrinho-icon img {
  width: 28px;
  height: 28px;
  filter: invert(1);
}

.carrinho-icon:hover {
  background: #1e40af;
  transform: scale(1.1);
}
/* Contador de itens */
#contadorCarrinho {
  position: absolute;
  top: -5px;
  right: -5px;
  background: #ef4444;
  color: white;
  font-size: 0.75em;
  font-weight: bold;
  width: 18px;
  height: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
}
/* Link de contato */
.contato-link {
  display: inline-block;
  margin-top: 6px;
  color: #ffffff;
  background: rgba(255,255,255,0.15);
  padding: 5px 12px;
  border-radius: 8px;
  font-weight: 500;
  cursor: pointer;
  transition: 0.3s;
}
.contato-link:hover {
  background: rgba(255,255,255,0.3);
  transform: scale(1.05);
}

/* Modal de Contatos */
.modal-contatos {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.6);
  justify-content: center;
  align-items: center;
  z-index: 2000;
}
.modal-contatos-content {
  background: #006efe;
  border-radius: 12px;
  padding: 30px 25px;
  width: 90%;
  max-width: 420px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.25);
  text-align: center;
  animation: slideDown 0.3s ease;
  margin-top: 200px;
}
.modal-contatos-content h2 {
  margin-top: 0;
  color: #1e3a8a;
  margin-bottom: 20px;
}
.fechar-contatos {
  position: absolute;
  top: 15px;
  right: 25px;
  font-size: 1.5em;
  cursor: pointer;
  color: #444;
}
.contato-opcoes {
  display: flex;
  flex-direction: column;
  gap: 15px;
}
.contato-opcoes a {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  text-decoration: none;
  background: #f3f4f6;
  border-radius: 10px;
  padding: 12px;
  font-size: 1em;
  color: #1e293b;
  transition: 0.3s;
}
.contato-opcoes a i {
  font-size: 1.2em;
}
.contato-opcoes a:hover {
  background: #2563eb;
  color: white;
  transform: scale(1.05);
}
@keyframes slideDown {
  from { transform: translateY(-40px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

.botoes-acoes {
  display: flex;
  justify-content: center;
  gap: 15px;
  margin-top: 15px;
}

.botoes-acoes button {
  background: #007bff;
  color: #fff;
  border: none;
  padding: 10px 18px;
  border-radius: 10px;
  font-size: 16px;
  cursor: pointer;
  transition: background 0.3s ease, transform 0.2s ease;
  display: flex;
  align-items: center;
  gap: 8px;
}

.botoes-acoes button:hover {
  background: #0056b3;
  transform: scale(1.05);
}

.btn-carrinho {
  background: #28a745;
}

.btn-carrinho:hover {
  background: #1e7e34;
}

/* ===== MODAL ===== */
/* Bot√£o Entrega */
#btnEntrega {
  background-color: #25d366;
  color: white;
  border: none;
  padding: 5px 12px;
  border-radius: 8px;
  font-weight: 500;
  font-size: 16px;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  transition: 0.3s;
  margin-top: -10px;
}

#btnEntrega:hover {
  background-color: #1ebc5b;
}
/* Modal de Entrega */
#modalEntrega {
  display: none;
  position: fixed;
  z-index: 9999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.5);
  justify-content: center;
  align-items: center;
}

/* Conte√∫do do modal */
#modalEntrega .modal-content {
  background-color: #fff;
  padding: 25px;
  border-radius: 12px;
  text-align: center;
  width: 90%;
  max-width: 450px;
  position: relative;
}

/* Bot√£o fechar do modal */
#modalEntrega .close {
  position: absolute;
  right: 15px;
  top: 10px;
  font-size: 22px;
  cursor: pointer;
  color: #555;
}

#modalEntrega .close:hover {
  color: #000;
}

/* Bot√£o do mapa dentro do modal */
#modalEntrega .botao-maps {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  background: #007bff;
  color: white;
  text-decoration: none;
  padding: 10px 18px;
  border-radius: 8px;
  font-weight: 500;
  margin-top: 15px;
  transition: 0.3s;
}

#modalEntrega .botao-maps:hover {
  background: #0056b3;
}

</style>
</head>
<body>
<header>
  <div class="logo">
    <img src="logo2.png" alt="Logo da loja">
    <span></span> ManchinhaPx Arts
  </div>
  <div class="header-text">
    Monte seu pedido direto no cat√°logo!
    Enviamos para todo o Brasil üáßüá∑
    Finalize tudo de forma r√°pida e segura pelo WhatsApp üí¨
      <br>
  <span class="contato-link" id="abrirContatos">üìû Contatos</span>
  <button id="btnEntrega" class="botao-contato">
  <i class="fas fa-map-marker-alt"></i> üìç Localiza√ß√£o
</button>
</div>

<!-- Modal de Entrega -->
<div id="modalEntrega" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>üìç Localiza√ß√£o</h2>
    <p>Retire seu pedido em nosso ponto f√≠sico:</p>

    <a href="https://maps.app.goo.gl/1pYhqNPGsAPRFVi3A" 
       target="_blank" 
       class="botao-maps">
      <i class="fas fa-map-marker-alt"></i> 
      BR-222, Km 317 Posto L-CAR Ca√ßimbas - Tiangu√° - CE
    </a>
  </div>
</div>

<!-- Modal de Contatos -->
<div class="modal-contatos" id="modalContatos">
  <div class="modal-contatos-content">
    <span class="fechar-contatos" id="fecharContatos">&times;</span>
    <h2>Entre em Contato</h2>
    <div class="contato-opcoes">
      <a href="https://wa.me/5588996077146" target="_blank">
        <i class="fab fa-whatsapp"></i> WhatsApp
      </a>
      <a href="https://www.instagram.com/manchinhapxarts?igsh=MTRlMnd0bHUwOGVuZg%3D%3D&utm_source=qr" target="_blank">
        <i class="fab fa-instagram"></i> Instagram
      </a>
      <a href="https://www.tiktok.com/@manchinhapxarts?_t=ZM-90kCJy4mJiN&_r=1" target="_blank">
        <i class="fas fa-tiktok"></i> Tiktok
      </a>
      <a href="tel:+5588996077146">
        <i class="fas fa-phone"></i> Telefone
      </a>
      
    </div>
  </div>
</div>

    <!-- Bot√£o WhatsApp profissional -->
<a href="https://wa.me/5588993800944" target="_blank" class="whatsapp-btn" title="Fale conosco no WhatsApp">
  <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
</a>

<!-- Carrinho -->
  <button id="btnCarrinho" class="carrinho-icon" title="Ver Carrinho">
    <img src="carrinho.png" alt="Carrinho" />
    <span id="contadorCarrinho">0</span>
  </button>
  </div>
</header>

<main>
  <h2>Filtrar por Categoria</h2>
  <div class="filtro-categoria" id="filtroCategorias"></div>
  <div class="catalogo" id="catalogo"></div>
</main>

<div class="carrinho" id="carrinho">
  <h3>üõí Meu Carrinho</h3>
  <div id="itensCarrinho"></div>
  <div class="total-carrinho" id="totalCarrinho">
    <span>Total:</span> <span>R$ 0,00</span>
  </div>
  <button class="finalizar" id="finalizar">Finalizar Pedido</button>
</div>

<div class="modal" id="modalForm">
  <div class="modal-content">
    <span class="fechar" id="fecharModal">&times;</span>
    <h3>Informa√ß√µes do Pedido</h3>
    <label>Nome do Cliente:</label>
    <input type="text" id="nomeCliente" placeholder="Digite seu nome" required>
    <label>Op√ß√£o:</label>
    <select id="tipoEntrega">
      <option value="Retirada">Retirada</option>
      <option value="Entrega">Entrega</option>
    </select>
    <div class="entrega-info" id="dadosEntrega">
      <label>Rua:</label><input type="text" id="rua" placeholder="Digite sua rua">
      <label>N√∫mero:</label><input type="text" id="numero" placeholder="N√∫mero">
      <label>Bairro:</label><input type="text" id="bairro" placeholder="Bairro">
      <label>Cidade:</label><input type="text" id="cidade" placeholder="Cidade">
      <label>CEP:</label><input type="text" id="cep" placeholder="CEP">
    </div>
    <button id="enviarPedido">Enviar Pedido via WhatsApp</button>
  </div>
</div>

<div class="modal" id="modalDetalhes">
  <div class="modal-content">
    <span class="fechar" id="fecharDetalhes">&times;</span>
    <div id="conteudoDetalhes"></div>
  </div>
</div>

<script>
let produtos = [];
const catalogo = document.getElementById('catalogo');
const itensCarrinho = document.getElementById('itensCarrinho');
let carrinho = [];
const filtroCategorias = document.getElementById('filtroCategorias');

// Modal de Entregas
const btnEntrega = document.getElementById("btnEntrega");
  const modalEntrega = document.getElementById("modalEntrega");
  const closeEntrega = modalEntrega.querySelector(".close");

  btnEntrega.addEventListener("click", () => {
    modalEntrega.style.display = "flex";
  });

  closeEntrega.addEventListener("click", () => {
    modalEntrega.style.display = "none";
  });

  window.addEventListener("click", (e) => {
    if (e.target === modalEntrega) {
      modalEntrega.style.display = "none";
    }
  });

// Modal de Contatos
const modalContatos = document.getElementById('modalContatos');
const abrirContatos = document.getElementById('abrirContatos');
const fecharContatos = document.getElementById('fecharContatos');

abrirContatos.addEventListener('click', () => {
  modalContatos.style.display = 'flex';
});

fecharContatos.addEventListener('click', () => {
  modalContatos.style.display = 'none';
});

window.addEventListener('click', (e) => {
  if (e.target === modalContatos) modalContatos.style.display = 'none';
});

// Carregar produtos
async function carregarProdutos() {
  try {
    const res = await fetch('/api/produtos'); 
    produtos = await res.json();

    const categorias = ['Todos', ...new Set(produtos.map(p=>p.categoria))];
    filtroCategorias.innerHTML = '';
    categorias.forEach(cat=>{
      const btn = document.createElement('button');
      btn.textContent = cat;
      btn.dataset.categoria = cat;
      if(cat==='Todos') btn.classList.add('active');
      btn.addEventListener('click', ()=> filtrarProdutos(cat, btn));
      filtroCategorias.appendChild(btn);
    });

    mostrarProdutos();
  } catch(err){
    console.error("Erro ao carregar produtos:", err);
    catalogo.innerHTML = "<p>Erro ao carregar produtos.</p>";
  }
}

function filtrarProdutos(categoria, btn){
  document.querySelectorAll('#filtroCategorias button').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  mostrarProdutos(categoria);
}

// Mostrar produtos com carrossel
function mostrarProdutos(categoria = "Todos") {
  catalogo.innerHTML = "";
  produtos.forEach((p,i)=>{
    if(categoria==='Todos' || p.categoria===categoria){
      const div = document.createElement('div');
      div.className = 'produto';

      function mudarImagemModal(dir){
  const carrossel = document.getElementById('carrossel-modal');
  if(!carrossel) return;
  const imgs = carrossel.querySelectorAll('img');
  let index = Array.from(imgs).findIndex(img => img.classList.contains('active'));
  imgs[index].classList.remove('active');
  index = (index + dir + imgs.length) % imgs.length;
  imgs[index].classList.add('active');
}

      div.innerHTML = `
        ${imagensHTML}
        <h3>${p.nome}</h3>
        <p>Categoria: ${p.categoria}</p>
        <p>Pre√ßo: R$ ${Number(p.preco).toFixed(2)}</p>
        <button onclick="adicionarCarrinho(${i})">Comprar</button>
      `;
      catalogo.appendChild(div);
    }
  });
}

// Navegar carrossel
function mudarImagem(i, dir){
  const carrossel = document.getElementById(`carrossel-${i}`);
  if(!carrossel) return;
  const imgs = carrossel.querySelectorAll('img');
  let index = Array.from(imgs).findIndex(img => img.classList.contains('active'));
  imgs[index].classList.remove('active');
  index = (index + dir + imgs.length) % imgs.length;
  imgs[index].classList.add('active');
}

// Carrinho
function adicionarCarrinho(i){
  const produto = produtos[i];
  const existe = carrinho.find(item => item.codigo === produto.codigo);
  if(existe){ existe.quantidade += 1; } 
  else { carrinho.push({...produto, quantidade:1}); }
  atualizarCarrinho();
}

function atualizarCarrinho(){
  itensCarrinho.innerHTML = '';
  let total = 0;

  carrinho.forEach((item,index)=>{
    const subtotal = Number(item.preco) * item.quantidade;
    total += subtotal;

    const div = document.createElement('div');
    div.className = 'carrinho-item';
    div.innerHTML = `
      <img src="${item.imagens?.[0] || 'https://via.placeholder.com/50'}" alt="${item.nome}">
      <div class="info">
        <strong>${item.nome}</strong>
        <span>Qtd: ${item.quantidade}</span>
        <span>R$ ${subtotal.toFixed(2)}</span>
      </div>
      <button onclick="removerCarrinho(${index})">‚úï</button>
    `;
    itensCarrinho.appendChild(div);
  });

  document.querySelector('#totalCarrinho span:last-child').textContent = `R$ ${total.toFixed(2)}`;
}

function removerCarrinho(index){
  carrinho.splice(index,1);
  atualizarCarrinho();
}

const btnCarrinho = document.getElementById('btnCarrinho');
const carrinhoDiv = document.getElementById('carrinho');

btnCarrinho.addEventListener('click', () => {
  carrinhoDiv.classList.toggle('aberto');
});

// Atualizar contador do carrinho automaticamente
function atualizarContador(){
  const contador = document.getElementById('contadorCarrinho');
  const totalItens = carrinho.reduce((sum, item)=> sum + item.quantidade, 0);
  contador.textContent = totalItens;
}

// Atualizar contador sempre que o carrinho mudar
function atualizarCarrinho(){
  itensCarrinho.innerHTML = '';
  let total = 0;

  carrinho.forEach((item,index)=>{
    const subtotal = Number(item.preco) * item.quantidade;
    total += subtotal;

    const div = document.createElement('div');
    div.className = 'carrinho-item';
    div.innerHTML = `
      <img src="${item.imagens?.[0] || 'https://via.placeholder.com/50'}" alt="${item.nome}">
      <div class="info">
        <strong>${item.nome}</strong>
        <span>Qtd: ${item.quantidade}</span>
        <span>R$ ${subtotal.toFixed(2)}</span>
      </div>
      <button onclick="removerCarrinho(${index})">‚úï</button>
    `;
    itensCarrinho.appendChild(div);
  });

  document.querySelector('#totalCarrinho span:last-child').textContent = `R$ ${total.toFixed(2)}`;
  atualizarContador();
}
// Modal
const modal = document.getElementById('modalForm');
const btnFinalizar = document.getElementById('finalizar');
const btnFechar = document.getElementById('fecharModal');
const tipoEntrega = document.getElementById('tipoEntrega');
const dadosEntrega = document.getElementById('dadosEntrega');
const btnEnviar = document.getElementById('enviarPedido');

btnFinalizar.addEventListener('click', ()=>{
  if(carrinho.length===0){ alert("O carrinho est√° vazio!"); return; }
  modal.style.display = 'block';
});

btnFechar.addEventListener('click', ()=> modal.style.display='none');
window.onclick = e=> { if(e.target===modal) modal.style.display='none'; };
tipoEntrega.addEventListener('change', ()=>{ dadosEntrega.style.display = tipoEntrega.value==='Entrega'? 'block':'none'; });

btnEnviar.addEventListener('click', ()=>{
  const nomeCliente = document.getElementById('nomeCliente').value.trim();
  if(!nomeCliente){ alert("Preencha seu nome!"); return; }

  let mensagem = `Ol√°, meu nome √© ${nomeCliente}.%0APedido:%0A`;
  let total = 0;
  carrinho.forEach(item=>{
    const subtotal = Number(item.preco) * item.quantidade;
    total += subtotal;
    mensagem += `- ${item.nome} x${item.quantidade} (R$ ${subtotal.toFixed(2)})%0A`;
  });

  mensagem += `Op√ß√£o: ${tipoEntrega.value}%0A`;
  if(tipoEntrega.value === 'Entrega'){
    const rua = document.getElementById('rua').value.trim();
    const numero = document.getElementById('numero').value.trim();
    const bairro = document.getElementById('bairro').value.trim();
    const cidade = document.getElementById('cidade').value.trim();
    const cep = document.getElementById('cep').value.trim();
    mensagem += `Endere√ßo: ${rua}, ${numero}, ${bairro}, ${cidade}, CEP: ${cep}%0A`;
  }

  mensagem += `%0ATotal: R$ ${total.toFixed(2)}`;
  const whatsapp = "5588993800944";
  window.open(encodeURI(`https://wa.me/${whatsapp}?text=${mensagem}`), "_blank");
  modal.style.display = 'none';
});

// Modal de detalhes
const modalDetalhes = document.getElementById('modalDetalhes');
const fecharDetalhes = document.getElementById('fecharDetalhes');
const conteudoDetalhes = document.getElementById('conteudoDetalhes');

function abrirDetalhes(index){
  const p = produtos[index];
  
  let imagensHTML = '';
  if (p.imagens && p.imagens.length > 0) {
    imagensHTML = `<div class="carrossel" id="carrossel-modal">`;
    p.imagens.forEach((img, j) => {
      imagensHTML += `<img src="${img}" class="${j === 0 ? 'active' : ''}" alt="${p.nome}">`;
    });
    imagensHTML += `
      <button class="prev" onclick="mudarImagemModal(-1)">&#10094;</button>
      <button class="next" onclick="mudarImagemModal(1)">&#10095;</button>
    </div>`;
  } else {
    imagensHTML = `<div style="width:100%; height:200px; background:#e2e8f0; display:flex; align-items:center; justify-content:center; border-radius:8px;">Sem imagem</div>`;
  }

  conteudoDetalhes.innerHTML = `
    ${imagensHTML}
    <h3>${p.nome}</h3>
    <p><strong>Pre√ßo:</strong> R$ ${Number(p.preco).toFixed(2)}</p>
    <p><strong>Descri√ß√£o:</strong> ${p.descricao || 'Sem descri√ß√£o'}</p>

    <div class="botoes-detalhes">
      <a href="https://wa.me/5588993800944?text=Ol√°,%20gostaria%20de%20comprar%20o%20produto%20${encodeURIComponent(p.nome)}" 
         target="_blank" 
         class="btn-detalhe whatsapp">Chamar no WhatsApp</a>
      <button onclick="adicionarCarrinho(${index}); fecharModalDetalhes()" 
              class="btn-detalhe comprar">üõí Comprar</button>
    </div>
  `;

  modalDetalhes.style.display = 'block';
}

function fecharModalDetalhes() {
  modalDetalhes.style.display = 'none';
}

function mudarImagemModal(dir){
  const carrossel = document.getElementById('carrossel-modal');
  if(!carrossel) return;
  const imgs = carrossel.querySelectorAll('img');
  let index = Array.from(imgs).findIndex(img => img.classList.contains('active'));
  imgs[index].classList.remove('active');
  index = (index + dir + imgs.length) % imgs.length;
  imgs[index].classList.add('active');
}

fecharDetalhes.addEventListener('click', ()=> modalDetalhes.style.display='none');
window.onclick = e=> { if(e.target===modalDetalhes) modalDetalhes.style.display='none'; };

// Alterar mostrarProdutos para usar "Ver Detalhes"
function mostrarProdutos(categoria = "Todos") {
  catalogo.innerHTML = "";
  produtos.forEach((p,i)=>{
    if(categoria==='Todos' || p.categoria===categoria){
      const div = document.createElement('div');
      div.className = 'produto';

      let imagensHTML = '';
      if(p.imagens && p.imagens.length > 0){
        imagensHTML = `<div class="carrossel" id="carrossel-${i}">`;
        p.imagens.forEach((img,j)=>{
          imagensHTML += `<img src="${img}" class="${j===0 ? 'active' : ''}">`;
        });
        imagensHTML += `
          <button class="prev" onclick="mudarImagem(${i},-1)">&#10094;</button>
          <button class="next" onclick="mudarImagem(${i},1)">&#10095;</button>
        </div>`;
      } else {
        imagensHTML = `<div style="width:100%; height:160px; background:#e2e8f0; display:flex; align-items:center; justify-content:center; border-radius:8px; margin-bottom:10px;">Sem imagem</div>`;
      }

      div.innerHTML = `
        ${imagensHTML}
        <h3>${p.nome}</h3>
        <p>Categoria: ${p.categoria}</p>
        <p>Pre√ßo: R$ ${Number(p.preco).toFixed(2)}</p>
        <button onclick="abrirDetalhes(${i})">Ver Detalhes</button>
      `;
      catalogo.appendChild(div);
    }
  });
}

// Iniciar
carregarProdutos();
</script>
</body>
</html>
