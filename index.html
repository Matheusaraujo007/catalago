<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CatÃ¡logo - Estilo Vendizap</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#ffffff;
    --muted:#f5f6f7;
    --line:#e6e7e8;
    --text:#111214;
    --muted-text:#6b6f73;
    --accent:#2b2b2b;
    --card-radius:12px;
    --shadow: 0 6px 18px rgba(16,24,40,0.06);
    --max-width:1200px;
  }
  *{box-sizing:border-box}
  body{
    font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background:var(--bg);
    color:var(--text);
    margin:0;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }
  header{
    border-bottom:1px solid var(--line);
    background:linear-gradient(180deg, #fff, #fbfbfb);
    padding:18px 20px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    position:sticky;
    top:0;
    z-index:40;
  }
  .brand{
    display:flex;
    align-items:center;
    gap:12px;
  }
  .logo{
    width:56px;height:56px;border-radius:10px;background:#f0f0f0;display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent);
  }
  .brand h1{font-size:1.1rem;margin:0}
  .header-actions{display:flex;gap:12px;align-items:center}
  .search{
    display:flex;align-items:center;gap:8px;background:var(--muted);border:1px solid var(--line);padding:8px 12px;border-radius:10px;min-width:220px;
  }
  .search input{border:0;background:transparent;outline:none;font-size:0.95rem;width:180px}
  .cart-btn{position:relative;background:var(--accent);color:white;border:0;padding:10px 14px;border-radius:10px;cursor:pointer;display:flex;align-items:center;gap:8px}
  .cart-count{position:absolute;top:-6px;right:-6px;background:#ef4444;color:white;border-radius:50%;width:20px;height:20px;font-size:12px;display:flex;align-items:center;justify-content:center;font-weight:700}
  main{max-width:var(--max-width);margin:28px auto;padding:0 18px}
  .top-controls{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px;gap:12px;flex-wrap:wrap}
  .filters{display:flex;gap:10px;flex-wrap:wrap}
  .filters button{background:transparent;border:1px solid var(--line);padding:8px 12px;border-radius:12px;cursor:pointer;color:var(--muted-text)}
  .filters button.active{background:var(--accent);color:white;border-color:var(--accent)}
  /* GRID */
  .grid{display:grid;grid-template-columns: repeat(4, 1fr);gap:18px}
  .card{
    background:white;border-radius:var(--card-radius);box-shadow:var(--shadow);border:1px solid var(--line);overflow:hidden;
    display:flex;flex-direction:column;transition:transform .16s;
  }
  .card:hover{transform:translateY(-6px)}
  .thumb{height:220px;background:#fafafa;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
  .thumb img{width:100%;height:100%;object-fit:cover;display:block}
  .card-body{padding:12px;display:flex;flex-direction:column;gap:8px;flex:1}
  .card-body h3{margin:0;font-size:1rem;color:var(--accent)}
  .card-body p{margin:0;color:var(--muted-text);font-size:0.9rem;flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .price-row{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-top:6px}
  .price{font-weight:700;color:var(--text)}
  .card-actions{display:flex;gap:8px;margin-top:10px}
  .btn{flex:1;padding:10px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
  .btn.primary{background:#111;text-align:center;color:white}
  .btn.ghost{background:transparent;border:1px solid var(--line);color:var(--accent)}
  /* Carrinho lateral */
  .drawer{position:fixed;right:-420px;top:0;height:100vh;width:380px;background:#fff;box-shadow: -20px 0 40px rgba(10,10,10,0.06);padding:18px;transition:right .32s;z-index:80;overflow-y:auto}
  .drawer.open{right:18px}
  .drawer h3{margin:0 0 12px 0}
  .cart-item{display:flex;gap:10px;align-items:center;padding:10px;border-radius:10px;background:var(--muted);margin-bottom:10px}
  .cart-item img{width:56px;height:56px;object-fit:cover;border-radius:8px}
  .cart-item .meta{flex:1}
  .cart-item .meta strong{display:block}
  .cart-footer{position:sticky;bottom:0;background:white;padding-top:10px;margin-top:12px;border-top:1px solid var(--line)}
  .total-row{display:flex;justify-content:space-between;align-items:center;font-weight:700;margin-bottom:10px}
  /* Modal */
  .modal{display:none;position:fixed;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.45);align-items:center;justify-content:center;z-index:120}
  .modal.open{display:flex}
  .modal-card{width:96%;max-width:720px;background:white;border-radius:12px;padding:18px}
  .modal-grid{display:grid;grid-template-columns: 1fr 320px;gap:18px}
  .modal-thumb{height:320px;background:#fafafa;border-radius:8px;overflow:hidden;display:flex;align-items:center;justify-content:center}
  .modal-thumb img{width:100%;height:100%;object-fit:contain}
  .modal-info h2{margin:0 0 8px 0}
  .chip{display:inline-block;padding:6px 8px;border-radius:8px;border:1px solid var(--line);color:var(--muted-text);font-weight:600}
  /* Responsive */
  @media(max-width:1000px){ .grid{grid-template-columns: repeat(3,1fr)} }
  @media(max-width:800px){ .grid{grid-template-columns:repeat(2,1fr)} .modal-grid{grid-template-columns:1fr} .modal-thumb{height:220px} }
  @media(max-width:520px){ header{padding:12px} .grid{grid-template-columns:1fr} .search input{width:100px} .brand h1{font-size:0.98rem} }
  /* small helpers */
  .muted{color:var(--muted-text);font-size:0.9rem}
  .center{display:flex;align-items:center;justify-content:center}
</style>
</head>
<body>

<header>
  <div class="brand">
    <div class="logo">MP</div>
    <div>
      <h1>ManchinhaPx Arts</h1>
      <div class="muted">Monte seu pedido direto no catÃ¡logo</div>
    </div>
  </div>

  <div class="header-actions">
    <div class="search" title="Pesquisar produtos">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35" stroke="#6b6f73" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="11" cy="11" r="6" stroke="#6b6f73" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      <input id="q" placeholder="Pesquisar produto..." />
    </div>

    <button id="abrirCarrinho" class="cart-btn">
      ðŸ›’ Carrinho
      <span id="cartCount" class="cart-count">0</span>
    </button>
  </div>
</header>

<main>
  <div class="top-controls">
    <div>
      <h2 style="margin:0 0 6px 0">CatÃ¡logo</h2>
      <div class="muted">Estilo Vendizap â€¢ Fundo branco â€¢ Detalhes em cinza/preto</div>
    </div>
    <div class="filters" id="filtros"></div>
  </div>

  <section id="produtosGrid" class="grid">
    <!-- cards gerados por JS -->
  </section>
</main>

<!-- Drawer Carrinho -->
<aside id="drawer" class="drawer" aria-hidden="true">
  <h3>ðŸ›’ Meu Carrinho</h3>
  <div id="cartItems"></div>
  <div class="cart-footer">
    <div class="total-row">
      <div>Total</div>
      <div id="cartTotal">R$ 0,00</div>
    </div>
    <div style="display:flex;gap:8px">
      <button id="btnCheckout" class="btn primary" style="flex:1">Finalizar</button>
      <button id="btnClear" class="btn ghost">Limpar</button>
    </div>
  </div>
</aside>

<!-- Modal Detalhes -->
<div id="modalDetalhes" class="modal" aria-hidden="true">
  <div class="modal-card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
      <strong>Detalhes do produto</strong>
      <button id="closeModal" class="btn ghost">Fechar</button>
    </div>
    <div class="modal-grid">
      <div class="modal-thumb center" id="modalImgWrap"></div>
      <div class="modal-info">
        <h2 id="modalTitle"></h2>
        <div class="muted" id="modalCategory"></div>
        <p id="modalDesc" style="margin-top:12px"></p>
        <div style="margin-top:12px;display:flex;gap:10px;align-items:center">
          <div style="font-weight:800;font-size:1.1rem" id="modalPrice"></div>
          <div class="chip" id="modalCode"></div>
        </div>
        <div style="margin-top:18px;display:flex;gap:10px" id="modalActions"></div>
      </div>
    </div>
  </div>
</div>

<script>
const API_URL = '/api/produtos';
const WHATSAPP_NUMBER = '5588993800944';

let produtos = [];
let categorias = ['Todos'];
let cart = JSON.parse(localStorage.getItem('cart_mancha')) || [];

const $ = sel => document.querySelector(sel);
const grid = $('#produtosGrid');
const filtrosWrap = $('#filtros');
const cartCount = $('#cartCount');
const drawer = $('#drawer');
const cartItems = $('#cartItems');
const cartTotal = $('#cartTotal');
const abrirCarrinho = $('#abrirCarrinho');
const btnCheckout = $('#btnCheckout');
const btnClear = $('#btnClear');

const modalDetalhes = $('#modalDetalhes');
const closeModal = $('#closeModal');
const modalImgWrap = $('#modalImgWrap');
const modalTitle = $('#modalTitle');
const modalDesc = $('#modalDesc');
const modalCategory = $('#modalCategory');
const modalPrice = $('#modalPrice');
const modalCode = $('#modalCode');
const modalActions = $('#modalActions');

/* ---- helpers ---- */
const money = v => 'R$ ' + Number(v || 0).toFixed(2).replace('.',',');
function escapeHtml(str=''){ return String(str).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

/* ---- carregar produtos ---- */
async function carregarProdutos(){
  try{
    const res = await fetch(API_URL);
    if(!res.ok) throw new Error('Erro API');
    produtos = await res.json();
    const setCat = new Set(produtos.map(p => p.categoria).filter(Boolean));
    categorias = ['Todos', ...setCat];
    renderFiltros();
    renderProdutos(produtos);
  }catch(err){
    console.error(err);
    grid.innerHTML = '<div style="grid-column:1/-1;padding:24px;color:red">Erro ao carregar produtos.</div>';
  }
}

/* ---- filtros ---- */
function renderFiltros(){
  filtrosWrap.innerHTML = '';
  categorias.forEach((c,i)=>{
    const btn = document.createElement('button');
    btn.textContent = c;
    btn.className = i===0?'active':'';
    btn.addEventListener('click',()=>{
      filtrosWrap.querySelectorAll('button').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      filtrar(c);
    });
    filtrosWrap.appendChild(btn);
  });
}

function filtrar(categoria){
  if(categoria==='Todos') return renderProdutos(produtos);
  renderProdutos(produtos.filter(p=>p.categoria===categoria));
}

/* ---- render produtos ---- */
function renderProdutos(lista){
  grid.innerHTML = '';
  lista.forEach((p,idx)=>{
    const card = document.createElement('article');
    card.className='card';
    const thumb = document.createElement('div');
    thumb.className='thumb';
    const img = document.createElement('img');
    img.src = (p.imagens && p.imagens[0]) || 'https://via.placeholder.com/600x400';
    img.alt = p.nome || 'Produto';
    thumb.appendChild(img);

    const body = document.createElement('div');
    body.className='card-body';
    body.innerHTML = `
      <h3>${escapeHtml(p.nome)}</h3>
      <p title="${escapeHtml(p.descricao||'')}">${escapeHtml(p.descricao||'')}</p>
      <div class="price-row"><div class="price">${money(p.preco)}</div></div>
      <div class="card-actions">
        <button class="btn ghost btn-detalhes" data-code="${escapeHtml(p.codigo)}">Ver Detalhes</button>
        <button class="btn primary btn-add" data-code="${escapeHtml(p.codigo)}">Adicionar</button>
      </div>
    `;
    card.appendChild(thumb);
    card.appendChild(body);
    grid.appendChild(card);
  });

  // adicionar event listeners
  $$('.btn-add').forEach(b=>b.addEventListener('click',()=>adicionarAoCarrinhoByCode(b.dataset.code)));
  $$('.btn-detalhes').forEach(b=>b.addEventListener('click',()=>verDetalhes(b.dataset.code)));
}

/* ---- busca ---- */
$('#q').addEventListener('input',e=>{
  const q = e.target.value.trim().toLowerCase();
  if(!q) return renderProdutos(produtos);
  renderProdutos(produtos.filter(p=>(p.nome||'').toLowerCase().includes(q)||(p.descricao||'').toLowerCase().includes(q)));
});

/* ---- carrinho ---- */
function adicionarAoCarrinhoByCode(code){
  const produto = produtos.find(p=>String(p.codigo)===String(code));
  if(!produto){ alert('Produto nÃ£o encontrado'); return; }

  const exist = cart.find(i=>String(i.codigo)===String(code));
  if(exist) exist.quantidade=(exist.quantidade||1)+1;
  else cart.push({...produto,quantidade:1});
  saveCart(); renderCart(); abrirDrawer();
}

function renderCart(){
  cartItems.innerHTML='';
  if(cart.length===0){
    cartItems.innerHTML='<div class="muted" style="padding:12px">Seu carrinho estÃ¡ vazio.</div>';
    cartCount.textContent='0';
    cartTotal.textContent=money(0);
    localStorage.setItem('cart_mancha',JSON.stringify(cart));
    return;
  }
  let total=0;
  cart.forEach((it,i)=>{
    const sub=Number(it.preco||0)*(it.quantidade||1);
    total+=sub;
    const div=document.createElement('div');
    div.className='cart-item';
    div.innerHTML=`
      <img src="${(it.imagens&&it.imagens[0])||'https://via.placeholder.com/80'}" alt="${escapeHtml(it.nome)}">
      <div class="meta"><strong>${escapeHtml(it.nome)}</strong><div class="muted">Qtd: ${it.quantidade} â€¢ ${money(sub)}</div></div>
      <div style="display:flex;flex-direction:column;gap:6px">
        <button onclick="increment(${i},1)">+</button>
        <button onclick="removeItem(${i})">âœ•</button>
      </div>
    `;
    cartItems.appendChild(div);
  });
  cartCount.textContent=String(cart.reduce((s,i)=>s+i.quantidade,0));
  cartTotal.textContent=money(total);
  localStorage.setItem('cart_mancha',JSON.stringify(cart));
}

function increment(i,d){cart[i].quantidade=Math.max(1,(cart[i].quantidade||1)+d); saveCart(); renderCart();}
function removeItem(i){cart.splice(i,1); saveCart(); renderCart();}
function saveCart(){localStorage.setItem('cart_mancha',JSON.stringify(cart));}

/* limpar carrinho */
btnClear.addEventListener('click',()=>{
  if(!confirm('Limpar o carrinho?')) return;
  cart=[]; saveCart(); renderCart();
});

/* drawer */
function abrirDrawer(){drawer.classList.add('open'); drawer.setAttribute('aria-hidden','false');}
function fecharDrawer(){drawer.classList.remove('open'); drawer.setAttribute('aria-hidden','true');}
abrirCarrinho.addEventListener('click',()=>drawer.classList.toggle('open'));

/* modal detalhes */
function verDetalhes(code){
  const p = produtos.find(x=>String(x.codigo)===String(code));
  if(!p) return;
  modalImgWrap.innerHTML=`<img src="${(p.imagens&&p.imagens[0])||'https://via.placeholder.com/600x400'}" alt="${escapeHtml(p.nome)}">`;
  modalTitle.textContent=p.nome||'â€”';
  modalDesc.textContent=p.descricao||'';
  modalCategory.textContent=p.categoria||'';
  modalPrice.textContent=money(p.preco);
  modalCode.textContent=p.codigo||'';

  modalActions.innerHTML='';
  const btnAdd=document.createElement('button');
  btnAdd.className='btn primary';
  btnAdd.textContent='Adicionar ao carrinho';
  btnAdd.addEventListener('click',()=>{
    adicionarAoCarrinhoByCode(String(p.codigo));
    fecharModalDetalhes();
  });
  modalActions.appendChild(btnAdd);

  modalDetalhes.classList.add('open');
  modalDetalhes.setAttribute('aria-hidden','false');
}

function fecharModalDetalhes(){modalDetalhes.classList.remove('open'); modalDetalhes.setAttribute('aria-hidden','true');}
closeModal.addEventListener('click',fecharModalDetalhes);
modalDetalhes.addEventListener('click',e=>{if(e.target===modalDetalhes) fecharModalDetalhes();});

/* load */
window.addEventListener('load',()=>{
  carregarProdutos();
  renderCart();
});

/* expose */
window.adicionarAoCarrinhoByCode=adicionarAoCarrinhoByCode;
window.increment=increment;
window.removeItem=removeItem;
window.abrirDrawer=abrirDrawer;
</script>

</body>
</html>
