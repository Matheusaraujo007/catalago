<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel - ManchinhaPx Arts</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
<style>
body { margin:0; font-family:"Poppins",sans-serif; background:#111; color:#fff; display:flex; height:100vh; overflow:hidden;}
.sidebar { width:250px; background:#222; display:flex; flex-direction:column; padding:20px 0; box-shadow:2px 0 10px rgba(0,0,0,0.5);}
.sidebar h2 { color:#f1d606; text-align:center; margin-bottom:20px;}
.sidebar button { background:none; border:none; color:#fff; padding:12px 20px; text-align:left; font-size:1em; cursor:pointer; width:100%; transition:0.3s;}
.sidebar button:hover, .sidebar button.active { background:#333;}
.content { flex:1; background:#111; overflow-y:auto; padding:20px;}
</style>
</head>
<body>

<div class="sidebar">
  <h2>ManchinhaPx Arts</h2>
  <button id="produtosBtn" class="active">Produtos</button>
</div>

<div class="content" id="contentArea">
  <!-- Aqui será carregado cadastropro.html ou lista de produtos -->
</div>

<script>
const contentArea = document.getElementById('contentArea');

function setActiveBtn(id){
  document.querySelectorAll('.sidebar button').forEach(btn=>btn.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// Carregar tela de produtos
document.getElementById('produtosBtn').addEventListener('click',()=>{
  setActiveBtn('produtosBtn');
  fetch('cadastropro.html')
    .then(res=>res.text())
    .then(html=>{
      contentArea.innerHTML = html;
      carregarProdutos(); // chama função para atualizar produtos do Neon
    })
    .catch(err=>contentArea.innerHTML=`<p style="color:red;">Erro ao carregar produtos</p>`);
});

// Função para atualizar produtos do banco Neon
async function carregarProdutos(){
  try {
    const res = await fetch('/api/produtos'); // seu endpoint no backend conectado ao Neon
    const produtos = await res.json();

    // Atualiza tabela se a tela de cadastro estiver carregada
    const tableBody = document.querySelector('#productTable tbody');
    if(!tableBody) return;

    tableBody.innerHTML = "";
    if(produtos.length === 0){
      tableBody.innerHTML = `<tr class="no-data"><td colspan="7">Nenhum produto cadastrado ainda.</td></tr>`;
      return;
    }

    produtos.forEach((p,i)=>{
      const imagem = p.imagens?.length > 0 ? `<img src="${p.imagens[0]}"/>` : '—';
      const linha = document.createElement('tr');
      linha.innerHTML = `
        <td class="miniatura">${imagem}</td>
        <td>${p.nome}</td>
        <td>${p.categoria}</td>
        <td>${parseFloat(p.preco).toFixed(2)}</td>
        <td>${p.estoque}</td>
        <td>${p.codigo}</td>
        <td class="acoes">
          <button class="editar" onclick="editarProduto(${i})">Editar</button>
          <button class="excluir" onclick="excluirProduto(${i})">Excluir</button>
        </td>
      `;
      tableBody.appendChild(linha);
    });
  } catch(err){
    console.error(err);
    const tableBody = document.querySelector('#productTable tbody');
    if(tableBody) tableBody.innerHTML = `<tr class="no-data"><td colspan="7">Erro ao carregar produtos</td></tr>`;
  }
}
</script>
</body>
</html>
